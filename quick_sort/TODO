complete in_place version
